cmake_minimum_required(VERSION 3.16)
project(GraphSimEnv LANGUAGES CXX)

# C++ standard
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Compiler flags
if (CMAKE_CXX_COMPILER_ID MATCHES "GNU|Clang")
    add_compile_options(-Wall -Wextra -Wpedantic -O2)
elseif (MSVC)
    add_compile_options(/W4)
endif()

# Hämta pybind11
add_subdirectory(externals/pybind11)

# Bestäm vilken fil som exponerar modulen till Python
set(BINDING_SRC "${CMAKE_SOURCE_DIR}/src/exposeToPy.cpp")

# Samla alla C++-filer i src/
# OBS: Använder en annan variabel för att undvika namnkrock
file(GLOB_RECURSE ALL_CPP_FILES "${CMAKE_SOURCE_DIR}/src/*.cpp")

# Filtrera bort bindningsfilen från listan för att förhindra dubbellänkning!
list(REMOVE_ITEM ALL_CPP_FILES ${BINDING_SRC})

# Skapa Python-modulen: BINDING_SRC läggs till först, följt av resten av källfilerna
pybind11_add_module(warehouse_env
    ${BINDING_SRC}
    ${ALL_CPP_FILES}
)

# Inkludera headers
target_include_directories(warehouse_env PRIVATE 
    ${CMAKE_SOURCE_DIR}/includes
)

# Länka rätt pybind11-bibliotek
target_link_libraries(warehouse_env PRIVATE pybind11::module)
